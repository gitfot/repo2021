<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="org.fun.test.contractType.dao.MiapOnlineshopContractTypeMapper">
  <resultMap id="BaseResultMap" type="org.fun.test.contractType.entity.MiapOnlineshopContractType">
    <id column="type_id" jdbcType="INTEGER" property="typeId" />
    <result column="contract_type_tc" jdbcType="VARCHAR" property="contractTypeTc" />
    <result column="contract_type_sc" jdbcType="VARCHAR" property="contractTypeSc" />
    <result column="contract_type_en" jdbcType="VARCHAR" property="contractTypeEn" />
    <result column="orderby" jdbcType="INTEGER" property="orderby" />
    <result column="display" jdbcType="INTEGER" property="display" />
    <result column="create_date" jdbcType="TIMESTAMP" property="createDate" />
    <result column="modified_date" jdbcType="TIMESTAMP" property="modifiedDate" />
    <result column="created_by" jdbcType="VARCHAR" property="createdBy" />
    <result column="modified_by" jdbcType="VARCHAR" property="modifiedBy" />
    <result column="contract_image" jdbcType="VARCHAR" property="contractImage" />
    <result column="label_tc" jdbcType="VARCHAR" property="labelTc" />
    <result column="label_en" jdbcType="VARCHAR" property="labelEn" />
    <result column="contract_desc" jdbcType="VARCHAR" property="contractDesc" />
    <result column="contract_fee_desc" jdbcType="VARCHAR" property="contractFeeDesc" />
    <result column="contract_gb" jdbcType="VARCHAR" property="contractGb" />
    <result column="contract_fee_rules" jdbcType="CLOB" property="contractFeeRules" />
    <result column="discount_msg_tc" jdbcType="CLOB" property="discountMsgTc" />
    <result column="discount_msg_en" jdbcType="CLOB" property="discountMsgEn" />
  </resultMap>
  <sql id="Base_Column_List">
    type_id, contract_type_tc, contract_type_sc, contract_type_en, orderby, display,
    create_date, modified_date, created_by, modified_by, contract_image, label_tc, label_en,
    contract_desc, contract_fee_desc, contract_gb, contract_fee_rules, discount_msg_tc,
    discount_msg_en
  </sql>

    <select id="getContractTypeAndClassById" resultType="java.util.Map">
        select oct.discount_msg_tc AS discountMsgTc,
        oct.discount_msg_en AS discountMsgEn,
        oct.class_id AS classId
        <if test='contractTypeClassId != null and contractTypeClassId != "" '>
            ,occ.class_name_tc AS classNameTc,
            occ.class_name_en AS classNameEn
        </if>
        from miap_onlineshop_contract_type oct

        <if test='contractTypeClassId != null and contractTypeClassId != "" '>
            left join miap_onlineshop_contract_type_class occ on occ.id = oct.class_id
        </if>

        where oct.type_id = #{contractTypeId,jdbcType=INTEGER}

        <choose>
            <when test='contractTypeClassId != null and contractTypeClassId !="" '>
                AND occ.id = #{contractTypeClassId,jdbcType=INTEGER}

                order by occ.orderby asc,oct.orderby asc LIMIT 1;
            </when>

            <otherwise>
                order by oct.orderby asc LIMIT 1;
            </otherwise>
        </choose>

    </select>
</mapper>
